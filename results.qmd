# Results


## Overall crime numbers in NY State and the impact of COVID-10


```{r, echo=FALSE,results='hide', message=FALSE, warning=FALSE}
library(viridis)
library(sf)
library(dplyr)
library(ggplot2)
library(patchwork)
library(gifski)
library(transformr)
library(dplyr)
library(ggplot2)
library(forcats)
library(gganimate)

crime_ny <- read.csv("data/Index_Crimes_by_County_and_Agency__Beginning_1990.csv")
pop_ny <- read.csv('data/Annual_Population_Estimates_for_New_York_State_and_Counties__Beginning_1970.csv')
pop_ny$FIPS.Code <- substr(pop_ny$FIPS.Code, 3, nchar(pop_ny$FIPS.Code))

pop_ny <- pop_ny[!((pop_ny$Year %in% c(1970,1980,1990,2000,2010,2020)) & 
(pop_ny$Program.Type != 'Census Base Population')),]

county_fips <- data.frame(
  FIPS = c(
    "001", "003", "005", "007", "009", "011", "013", "015", "017", "019", "021",
    "023", "025", "027", "029", "031", "033", "035", "037", "039", "041",
    "043", "045", "047", "049", "051", "053", "055", "057", "059", "061",
    "063", "065", "067", "069", "071", "073", "075", "077", "079", "081",
    "083", "085", "087", "089", "089", "091", "093", "095", "097", "099", "101",
    "103", "105", "107", "109", "111", "113", "115", "117", "119", "121", "123"
  ),
  Name = c(
    "Albany", "Allegany", "Bronx", "Broome", "Cattaraugus", "Cayuga", "Chautauqua",
    "Chemung", "Chenango", "Clinton", "Columbia", "Cortland", "Delaware",
    "Dutchess", "Erie", "Essex", "Franklin", "Fulton", "Genesee", "Greene",
    "Hamilton", "Herkimer", "Jefferson", "Kings", "Lewis", "Livingston",
    "Madison", "Monroe", "Montgomery", "Nassau", "New York", "Niagara",
    "Oneida", "Onondaga", "Ontario", "Orange", "Orleans", "Oswego",
    "Otsego", "Putnam", "Queens", "Rensselaer", "Richmond", "Rockland",
    "St. Lawrence", "St Lawrence", "Saratoga", "Schenectady", "Schoharie", "Schuyler",
    "Seneca", "Steuben", "Suffolk", "Sullivan", "Tioga", "Tompkins",
    "Ulster", "Warren", "Washington", "Wayne", "Westchester", "Wyoming", "Yates"
  )
)
crime_ny$County <- as.character(crime_ny$County)
crime_ny_with_fips <- merge(crime_ny, county_fips, by.x = "County", by.y = "Name", all.x = TRUE)
crime_ny_with_fips <- crime_ny_with_fips[crime_ny_with_fips$Agency == 'County Total', ]

crime_ny_with_fips_and_pop <- merge(crime_ny_with_fips, 
                                    pop_ny, by.x = c("FIPS", "Year"), 
                                    by.y = c("FIPS.Code", "Year"), 
                                    all.x = TRUE)

crime_ny_with_fips_and_pop <- crime_ny_with_fips_and_pop[!is.na(crime_ny_with_fips_and_pop$Index.Total), ]
crime_ny_with_fips_and_pop <- crime_ny_with_fips_and_pop[, !(names(crime_ny_with_fips_and_pop) %in% c("Geography", "Program.Type"))]
```




```{r}
crime_ny$Year <- as.numeric(crime_ny$Year)
crime_ny_filtered <- crime_ny %>%
  mutate(Year_Period = cut(Year, 
                           breaks = seq(1985, max(Year) + 5, 
                           by = 5), 
                           labels = FALSE),
         Year_Period_Label = paste0(floor((Year - 1985) / 5) * 5 + 1985,
                                    "-",
                                    floor((Year - 1985) / 5) * 5 + 1989)
         )

crime_ny_filtered_county_tot <- crime_ny_filtered[crime_ny_filtered$Agency=='County Total',]

tot_yearly <- crime_ny_filtered_county_tot %>%
  group_by(Year) %>%
  summarise(
    Total_Index = sum(Index.Total)
  ) %>%
  ungroup()

ggplot(tot_yearly, aes(x = Year, 
                      y = Total_Index)) +
  geom_bar(stat = "identity") +
  scale_fill_viridis_c() +
  theme_minimal() +
  labs(title = "Total number of crimes in NY State by year",
       x = "Year",
       y = "Total number of recorded crimes")

```

We see an interesting uptick after 2021 potentially due to COVID-19. Worth investigating more!


```{r}

crime_ny_with_fips_and_pop$crime_pct <- crime_ny_with_fips_and_pop$Index.Total/crime_ny_with_fips_and_pop$Population

tot_yearly <- crime_ny_with_fips_and_pop %>%
  group_by(Year) %>%
  summarise(
    Total_crime = sum(Index.Total)
  ) %>%
  ungroup()

tot_yearly <- merge(tot_yearly, pop_ny[pop_ny$Geography == 'New York State', ], by.x = "Year", by.y = "Year", all.x = TRUE)

tot_yearly$pct <- tot_yearly$Total_crime/tot_yearly$Population

ggplot(tot_yearly, aes(x = Year, 
                      y = pct)) +
  geom_bar(stat = "identity") +
  scale_fill_viridis_c() +
  theme_minimal() +
  labs(title = "Crimes per population of crimes in NY State by year",
       x = "Year",
       y = "Recorded crimes per population")
```


### Increase in crimes per population per county


```{r}

impact_of_covid <- crime_ny_with_fips_and_pop
impact_of_covid$crime_pct <- impact_of_covid$Index.Total/impact_of_covid$Population
impact_of_covid <- impact_of_covid[impact_of_covid$Year > 2015, ]

crime_increase <- impact_of_covid[impact_of_covid$Year > 2020, ] %>%
  group_by(County) %>%
  summarize(increase = last(crime_pct) - first(crime_pct)) %>%
  filter(!is.na(increase))

top_counties <- crime_increase %>% top_n(10, wt = increase)

selected_data <- impact_of_covid %>%
  filter(County %in% top_counties$County)

county_order <- names(sort(tapply(selected_data$crime_pct, selected_data$County, max), decreasing = TRUE))
selected_data$County <- factor(selected_data$County, levels = county_order)

my_palette <- viridis_pal()(length(unique(selected_data$County)))

ggplot(selected_data, aes(x = Year, y = crime_pct, color = County)) +
  geom_line() +
  scale_color_manual(values = my_palette) +
  labs(title = "Crime/population per Year for Counties with worst increase post-covid",
       x = "Year",
       y = "Crime/population") +
  theme_minimal()

```

```{r}
library(viridis)

impact_of_covid <- crime_ny_with_fips_and_pop
impact_of_covid$crime_pct <- impact_of_covid$Index.Total/impact_of_covid$Population
impact_of_covid <- impact_of_covid[impact_of_covid$Year > 2015, ]

bottom_counties <- crime_increase %>% top_n(10, wt = -increase)

selected_data <- impact_of_covid %>%
  filter(County %in% bottom_counties$County)

county_order <- names(sort(tapply(selected_data$crime_pct, selected_data$County, max), decreasing = TRUE))
selected_data$County <- factor(selected_data$County, levels = county_order)

my_palette <- viridis_pal()(length(unique(selected_data$County)))

ggplot(selected_data, aes(x = Year, y = crime_pct, color = County)) +
  geom_line() +
  scale_color_manual(values = my_palette) +
  labs(title = "Crime/population per Year for Counties with least increase post-covid",
       x = "Year",
       y = "Crime/population") +
  theme_minimal()

```

Draw on map where each of these counties lie and see if there is a geographical connection.



## Crime rates (per population size) per counties for 5 year periods


```{r}
combined_data <- crime_ny_filtered_county_tot %>%
  group_by(Year_Period_Label, County) %>%
  summarise(
    Total_Index = sum(Index.Total),
  ) %>%
  ungroup()

top_5_counts <- combined_data %>%
  group_by(Year_Period_Label) %>%
  top_n(5, wt = Total_Index) %>%
  ungroup()

top_5_counts$County <- fct_reorder(top_5_counts$County, 
                                   top_5_counts$Total_Index, 
                                   .desc = TRUE)

top_5_counts <- top_5_counts %>%
  group_by(Year_Period_Label) %>%
  mutate(Rank = -rank(Total_Index))

top_5_counts$County <- fct_reorder(top_5_counts$County, top_5_counts$Rank)


ggplot(top_5_counts, aes(x = County, 
                         y = Total_Index)) +
  geom_bar(stat = "identity") +
  facet_wrap(~Year_Period_Label, 
             scales = "free_x", #"free_x",
             nrow = 5) +
  scale_fill_viridis_c() +
  theme_minimal() +
  labs(title = "Index.Total by County",
       x = "County",
       y = "Index.Total")
```



## Overall crime numbers in NY State and the impact of COVID-10


## Impact of stop-and-frisk on crime statistics under Bloomberg


<!-- 
https://www.nyclu.org/en/stop-and-frisk-data
-->

